<!DOCTYPE html>
<html>
<head>
    <title>Здесь был #скбконтур</title>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <link rel='stylesheet' type='text/css' href='style.css'>
    <script src='http://yastatic.net/jquery/2.1.3/jquery.min.js' type='text/javascript'></script>
    <script src='http://api-maps.yandex.ru/2.1/?lang=ru_RU' type='text/javascript'></script>
</head>

<body>
    <div id='map'></div>

    <script type='text/javascript'>
        var resizeMap = function() {
            $('#map').width($(window).width());
            $('#map').height($(window).height());
        };

        $(window).resize(resizeMap);

        $(function() {
            resizeMap();
        })

        ymaps.ready(function() { 
            var map = new ymaps.Map('map', {
                center: [55.76, 37.64],
                zoom: 10,
                controls: ['zoomControl']
            });

            var clusterer = new ymaps.Clusterer({ clusterDisableClickZoom: true });
            map.geoObjects.add(clusterer);

            $.get('/data', function(data) {
                map.setCenter([
                    data.center.latitude,
                    data.center.longitude
                ], 6);

                map.setBounds([[
                    data.bounds.min_latitude,
                    data.bounds.min_longitude
                ], [
                    data.bounds.max_latitude,
                    data.bounds.max_longitude
                ]]);

                data.photos.forEach(function (photo) {
                    clusterer.add(new ymaps.Placemark([
                        photo.location.latitude,
                        photo.location.longitude
                    ], {
                        balloonContentHeader: photo.user.full_name || photo.user.username,
                        balloonContentBody: '<img src="' + photo.image.url + '">',
                        balloonContentFooter: photo.location.name,
                        hintContent: '@' + photo.user.username
                    }, {
                        preset:    'islands#circleIcon',
                        iconColor: 'rgb(211, 42, 44)'
                    }));
                });
            });
        });
    </script>
</body>
</html>